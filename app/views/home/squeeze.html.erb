<div class="cd-intro-block">
	<div class="content-wrapper"><div id="googlemaps"></div>

Iniciativas Ambientales
<div class=\"row\">
  <div class=\"col-md-9\">
    <div id=\"initiatives_form\">
      <%= form_tag initiatives_path, :method => :get, remote: true do |f| %>
        <!-- <%= select_tag :section, options_from_collection_for_select(Section.all, "id", "title", params[:section] || ""), prompt: "Seleccionar SecciÃ³n", class: "chosen-select" %> -->
        <%= select_tag :area, options_from_collection_for_select(Area.joins(:posts).where('posts.area_id is not null').distinct, "id", "name", ""), include_blank:  t('.select_area'), class: "chosen-select", id: "initiatives_area_select", onchange: "loadPostsAndShow();"%>
        <!-- <%= submit_tag t('.select_area'), class: "btn", id:"initiatives_form_button" %> -->
      <% end %>
    </div>
    <div id="initiatives_list">

    </div>
  </div>
</div>


		<h1>Squeezebox Portfolio Template</h1>
		<a href="" class='cd-btn' data-action="show-projects">Show projects</a>
	</div>
</div> <!-- .cd-intro-block -->

<div class="cd-projects-wrapper">
	<ul class="cd-slider">
	<% @initiatives.each_with_index do |initiative, index|%>
		<li <%= index == 0? 'class="current"' : nil  %>>
			<a href="" id="post_thumb_<%=initiative.id %>">
				<img src="/assets/img.png" alt="">
				<div class="project-info">
					<h2> <%= initiative.title %> </h2>
					<p> <%= initiative.title %> </p>
					<p>
						<%= rating_for initiative, "problem", disable_after_rate: true, imdb_avg: true %>
					</p>
				</div>
			</a>
		</li>
	<% end %>

	<li>
		<a href="">
			<img src="/assets/img.png" alt="project image">
			<div class="project-info">
				<h2>Project 1</h2>
				<p>Lorem ipsum dolor sit amet.</p>
			</div>
		</a>
	</li>
	<li>
		<a href="">
			<img src="/assets/img.png" alt="project image">
			<div class="project-info">
				<h2>Project 1</h2>
				<p>Lorem ipsum dolor sit amet.</p>
			</div>
		</a>
	</li>
	</ul>

	<ul class="cd-slider-navigation cd-img-replace">
		<li><a href="" class="prev disabled">Prev</a></li>
		<li><a href="" class="next">Next</a></li>
	</ul> <!-- .cd-slider-navigation -->
</div> <!-- .cd-projects-wrapper -->

<div class="cd-project-content">
	<div>
		<h2>Project title here</h2>
		<em>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sunt, ullam.</em>
		<!-- other content here -->
	</div>
	<a href="" class="close cd-img-replace">Close</a>
</div> <!-- .cd-project-content -->

<script src="http://maps.googleapis.com/maps/api/js?sensor=false&key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>"></script>

<script type="text/javascript">

// The latitude and longitude of your business / place
var position = [-33.446165, -70.665767];

function showGoogleMaps() {

    var latLng = new google.maps.LatLng(position[0], position[1]);

    var mapOptions = {
        zoom: 10, // initialize zoom level - the max value is 21
        streetViewControl: false, // hide the yellow Street View pegman
        scaleControl: false, // allow users to zoom the Google Map
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: latLng
    };

    map = new google.maps.Map(document.getElementById('googlemaps'),
        mapOptions);

    <% vitacura = Area.find_by_name 'Vitacura' %>
    <% geojson_polygon = RGeo::GeoJSON.encode vitacura.geom%>

    <% post_areas = Post.select(:area_id).distinct %>
    <% post_areas.each do |post_area| %>
      <% area = Area.find(post_area.area_id) %>
        <% unless area.geom.nil? %>
          var contentString = '<div id="content">'+' <%= area.name %> '+ '</div>';
          var infowindow_<%= area.id %> = new google.maps.InfoWindow({
            content: contentString
          });

          var latlong = {lat: -25.363, lng: 131.044};

          var marker_<%= area.id %> = new google.maps.Marker({
            position: <%= raw area.centroid_coordinates %>,
            map: map,
            title: '<%= area.name %>',
            draggable: false,
            animation: google.maps.Animation.DROP
          });

          marker_<%= area.id %>.addListener('click', function() {
            infowindow_<%= area.id %>.open(map, marker_<%= area.id %>);
          });

          var geojson_polygon = JSON.parse('<%= raw area.geojson %>')
          map.data.addGeoJson(geojson_polygon);

        <% end %>
    <% end %>


}

google.maps.event.addDomListener(window, 'load', showGoogleMaps);
$('.chosen-select').chosen();
</script>
